Connection between webserver and LEAM core computation program
==============================================================
leampoll.py is the connection from webserver (portal) to server side program. It uses supervisor program to receive http requrests and parse the request to run the server side program.

In leam, the connection between webserver and leam program works as the following 4 steps. 

*Each scenario can only "submit for publication"  once after creating a new scenario on portal.leam.illinois.edu/chicagotest.*

1. After "submit for publication" for one scenario, the http json request will be sent to job server and accept by the **supervisor** program.
   * The supervisor configuration files for each site locates at /etc/supervisor/conf.d 
   * The supervisor log files locates at /var/log/supervisor, which specified (1) command (2) directory
to run.
   * Once configuration or the plone site has been restarted, use `sudo service supervisor stop/start` to restart supervisor.

2. The supervisor program will follow its configuration file to run **leampoll** program in the site directory in /leam/scratch
   * leampoll program is in /usr/local/bin.
   * If successfully runing the leampoll, supervisor log file in /var/log/supervisor will has "leampoll: INFO: New Job = 'scenario160809' " as the logger.info() function asks to do. 

3. The leampoll program download a folder for the scenario from the plone **svn**.
   * Each site's svn folder is saved in portal server /home/svn as defined in portal server /etc/apache2/apache2.conf
   * The svn folder file cannot be viewed directly from the portal server, but can be viewed in browser with url portal.leam.illinois.edu/svn/chicagotest as a Plone FTP. 
   * As specified in default [registry.xml][svnlink1] and [controlpanel.xml][svnlink2]in leam.luc, the svn directory for each site is defined through plone interface inputs only through the url: portal.leam.illinois.edu:8095/plone/@@luc-model-settings (8095 the port # is for chicagotest). This link can only access from portal sever's browser.
00
4. The leampoll program will download model **configuration** file and **grass** folder into the cleaned scenario folder just downloaded from svn.
   * The configuration file will be generated by running the [getConfig][configlink] function in leam.luc.
   * The grass folder should be uploaded to portal.leam.illinois.edu/chicagotest/resouces/grass before any scenario runs. This is specified in [grassloc][grasslink].

5. The leampoll program will then run the **startup.py** downloaded with the svn folder for the land use change model. This process is in the command created in configuration file as specified in [cmdline function][cmdlink1] and the [default file][cmdlink2].

[svnlink1]:https://github.com/HelenRouty/LEAM-plone/blob/master/leam.luc/leam/luc/profiles/default/registry.xml 
[svnlink2]:https://github.com/HelenRouty/LEAM-plone/blob/master/leam.luc/leam/luc/profiles/default/controlpanel.xml
[configlink]:https://github.com/HelenRouty/LEAM-plone/blob/master/leam.luc/leam/luc/content/lucscenario.py#L350
[grasslink]:https://github.com/HelenRouty/LEAM-plone/blob/master/leam.luc/leam/luc/content/lucscenario.py#L366
[cmdlink1]:https://github.com/HelenRouty/LEAM-plone/blob/master/leam.luc/leam/luc/content/lucscenario.py#L196
[cmdlink2]:https://github.com/HelenRouty/LEAM-plone/blob/master/leam.luc/leam/luc/interfaces/settings.py#L21

leam.monitor
============
A simple polling process that checks the queue on the plone site and executes any job that is ready to run.

The polling process requests pop_queue against the plone site. If a job is queued a response will include a title, 
an ID, the repository, and the cmdline.  If repository is given then the poll.py should checkout the latest code into 
a working directory otherwise an empty working directory will be created.  In both cases the working directory name will
be the ID provided in the response.  Next the cmdline should be executed in the working directory.  Poll.py will wait 
for the processes to complete before returning polling for the next job.

*Poll.py is currently setup to be backwards compatiable with our VERY early portals.  The use of XML-RPC is 
depricated in favor of a more RESTful approach using JSON.* 

Installation
------------
Run the following command in the desired folder:

git clone https://github.com/LEAMGroup/leam.monitor

Requires
--------
[requests](http://docs.python-requests.org/en/latest/) - an HTTP library, written in Python, for human beings

